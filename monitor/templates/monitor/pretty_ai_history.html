{% extends 'monitor/pretty_base.html' %}

{% block title %}–ò—Å—Ç–æ—Ä–∏—è AI - AI Monitor{% endblock %}

{% block content %}
<div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">üìö –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ —Å AI</h2>
    <p class="text-gray-600">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {{ total_messages }}</p>
</div>

{% if not connected %}
<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
    <div class="flex items-center">
        <i class="fas fa-exclamation-triangle text-yellow-500 mr-3"></i>
        <div>
            <h3 class="font-semibold text-yellow-800">SSH –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</h3>
            <p class="text-yellow-700 text-sm">–ò—Å—Ç–æ—Ä–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω–æ–π</p>
        </div>
    </div>
</div>
{% endif %}

{% if total_messages == 0 %}
<div class="bg-white rounded-xl shadow-sm border p-8 text-center">
    <div class="text-6xl mb-4">üí¨</div>
    <h3 class="text-xl font-semibold text-gray-800 mb-2">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</h3>
    <p class="text-gray-600 mb-6">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–¥–µ—Å—å</p>
    <a href="/ai-chat/"
       class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors inline-block">
        <i class="fas fa-robot mr-2"></i>–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ
    </a>
</div>
{% else %}
<div class="space-y-4">
    {% for message in history %}
    <div class="bg-white rounded-xl shadow-sm border p-4 {% if message.role == 'user' %}border-blue-200{% else %}border-purple-200{% endif %}">
        <div class="flex items-start space-x-3">
            <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center
                {% if message.role == 'user' %}bg-blue-100 text-blue-600{% else %}bg-purple-100 text-purple-600{% endif %}">
                {% if message.role == 'user' %}
                    üë§
                {% else %}
                    ü§ñ
                {% endif %}
            </div>
            <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between mb-2">
                    <span class="font-semibold text-gray-800">
                        {% if message.role == 'user' %}
                            –í—ã
                        {% else %}
                            AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç
                        {% endif %}
                    </span>
                    <span class="text-xs text-gray-500">{{ forloop.counter }}</span>
                </div>
                <div class="text-gray-700 whitespace-pre-wrap">{{ message.content }}</div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- –î–µ–π—Å—Ç–≤–∏—è -->
<div class="mt-6 bg-white rounded-xl shadow-sm p-6 border">
    <h3 class="text-lg font-semibold mb-4">‚ö° –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π</h3>
    <div class="flex flex-wrap gap-4">
        <button onclick="location.reload()"
                class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
        </button>
        <button onclick="clearHistory()"
                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
        </button>
        <a href="/ai-chat/"
           class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors inline-block">
            üí¨ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—â–µ–Ω–∏–µ
        </a>
    </div>
</div>
{% endif %}

<script>
function clearHistory() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤?')) {
        fetch('/api/ai/clear-history/', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            })
            .catch(error => {
                alert('–û—à–∏–±–∫–∞: ' + error);
            });
    }
}
</script>
{% endblock %}