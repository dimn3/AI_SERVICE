{% extends 'monitor/base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-8">üê≥ Docker –º–µ–Ω–µ–¥–∂–µ—Ä</h1>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Docker —Å–∏—Å—Ç–µ–º–µ -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Docker —Å–∏—Å—Ç–µ–º–µ</h2>
            <button hx-get="/api/docker/system/" hx-target="#docker-system-info"
                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            </button>
        </div>
        <div id="docker-system-info">
            <div class="text-center py-8 text-gray-500">
                –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Docker —Å–∏—Å—Ç–µ–º–µ...
            </div>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">üì¶ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã</h2>
            <div class="space-x-2">
                <button hx-get="/api/docker/containers/" hx-target="#docker-containers"
                        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    –¢–æ–ª—å–∫–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ
                </button>
                <button hx-get="/api/docker/containers/?all=true" hx-target="#docker-containers"
                        class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                </button>
            </div>
        </div>
        <div id="docker-containers">
            <div class="text-center py-8 text-gray-500">
                –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...
            </div>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">üîç –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- –í—ã–±–æ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
            <div class="lg:col-span-1">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:</label>
                    <select id="container-select" class="border border-gray-300 rounded px-3 py-2 w-full"
                            onchange="loadContainerInfo(this.value)">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä --</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <button onclick="loadContainerLogs()"
                            class="w-full bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                        üìù –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
                    </button>
                    <button onclick="loadContainerStats()"
                            class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    </button>
                    <button onclick="loadContainerProcesses()"
                            class="w-full bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                        üöÄ –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
                    </button>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ -->
            <div class="lg:col-span-2">
                <div id="container-info" class="bg-gray-50 rounded p-4 min-h-64">
                    <p class="text-gray-500 text-center py-8">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                </div>
            </div>
        </div>

        <!-- –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
        <div id="container-logs-section" class="mt-6 hidden">
            <h3 class="text-lg font-semibold mb-4">üìù –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞</h3>
            <div class="flex space-x-2 mb-4">
                <button onclick="loadContainerLogs(50)"
                        class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm">
                    50 —Å—Ç—Ä–æ–∫
                </button>
                <button onclick="loadContainerLogs(100)"
                        class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm">
                    100 —Å—Ç—Ä–æ–∫
                </button>
                <button onclick="loadContainerLogs(200)"
                        class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 text-sm">
                    200 —Å—Ç—Ä–æ–∫
                </button>
            </div>
            <div id="container-logs" class="bg-gray-900 text-green-400 rounded p-4 font-mono text-sm max-h-96 overflow-y-auto">
            </div>
        </div>
    </div>
</div>

<script>
let currentContainerId = '';

function loadContainersList() {
    htmx.ajax('GET', '/api/docker/containers/?all=true', {
        target: '#docker-containers',
        swap: 'innerHTML'
    });
}

function updateContainerSelect(containers) {
    const select = document.getElementById('container-select');
    select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä --</option>';

    containers.forEach(container => {
        const option = document.createElement('option');
        option.value = container.id;
        option.textContent = `${container.name} (${container.status})`;
        select.appendChild(option);
    });
}

function loadContainerInfo(containerId) {
    if (!containerId) return;
    currentContainerId = containerId;

    htmx.ajax('GET', `/api/docker/containers/${containerId}/`, {
        target: '#container-info'
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é –ª–æ–≥–æ–≤
    document.getElementById('container-logs-section').classList.remove('hidden');
}

function loadContainerLogs(lines = 50) {
    if (!currentContainerId) return;

    htmx.ajax('GET', `/api/docker/containers/${currentContainerId}/logs/?lines=${lines}`, {
        target: '#container-logs'
    });
}

function loadContainerStats() {
    if (!currentContainerId) return;

    htmx.ajax('GET', `/api/docker/containers/${currentContainerId}/stats/`, {
        target: '#container-info'
    });
}

function loadContainerProcesses() {
    if (!currentContainerId) return;

    htmx.ajax('GET', `/api/docker/containers/${currentContainerId}/processes/`, {
        target: '#container-info'
    });
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadContainersList();
    htmx.ajax('GET', '/api/docker/system/', { target: '#docker-system-info' });
});
</script>
{% endblock %}