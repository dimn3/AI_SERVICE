{% extends 'monitor/base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">üìä –î–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>
        <p class="text-xl text-gray-600">–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞</p>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        <!-- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-l-4 border-blue-500">
            <div class="flex items-center justify-between mb-4">
                <div class="bg-blue-100 p-3 rounded-xl">
                    <i class="fas fa-server text-blue-600 text-xl"></i>
                </div>
                <div id="status-indicator" class="w-3 h-3 bg-gray-400 rounded-full"></div>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</h3>
            <div id="connection-status" class="text-sm text-gray-600 min-h-[40px] break-words">
                <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</p>
            </div>
            <div class="mt-4 space-x-2">
                <button onclick="connectServer()"
                        class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 text-sm transition-colors">
                    <i class="fas fa-plug mr-2"></i>–ü–æ–¥–∫–ª—é—á–∏—Ç—å
                </button>
                <button onclick="disconnectServer()"
                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 text-sm transition-colors">
                    <i class="fas fa-power-off mr-2"></i>–û—Ç–∫–ª—é—á–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –ò–ò –ê–≥–µ–Ω—Ç -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-l-4 border-purple-500">
            <div class="flex items-center justify-between mb-4">
                <div class="bg-purple-100 p-3 rounded-xl">
                    <i class="fas fa-robot text-purple-600 text-xl"></i>
                </div>
                <div id="ai-status-indicator" class="w-3 h-3 bg-gray-400 rounded-full"></div>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">–ò–ò –ê–≥–µ–Ω—Ç</h3>
            <div id="ai-status" class="text-sm text-gray-600 min-h-[40px] break-words">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</p>
            </div>
            <button onclick="checkAIStatus()"
                    class="mt-4 w-full bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                <i class="fas fa-sync-alt mr-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>

        <!-- –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-l-4 border-green-500">
            <div class="bg-green-100 p-3 rounded-xl w-fit mb-4">
                <i class="fas fa-bolt text-green-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">–ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h3>
            <div id="quick-diagnostic-result" class="text-sm text-gray-600 min-h-[40px] break-words scrollable-content">
                <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞</p>
            </div>
            <button onclick="runQuickDiagnostic()"
                    class="mt-4 w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                <i class="fas fa-play mr-2"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å
            </button>
        </div>

        <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã -->
        <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-l-4 border-orange-500">
            <div class="bg-orange-100 p-3 rounded-xl w-fit mb-4">
                <i class="fas fa-microchip text-orange-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">–†–µ—Å—É—Ä—Å—ã —Å–∏—Å—Ç–µ–º—ã</h3>
            <div id="system-resources" class="text-sm text-gray-600 min-h-[40px] break-words scrollable-content">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
            </div>
            <button onclick="loadSystemResources()"
                    class="mt-4 w-full bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors">
                <i class="fas fa-chart-bar mr-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
            </button>
        </div>
    </div>

    <!-- Docker –∏ –ª–æ–≥–∏ -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                    <i class="fab fa-docker text-blue-500 mr-3"></i>
                    Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
                </h2>
                <button onclick="loadDockerContainers()"
                        class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                    <i class="fas fa-sync-alt mr-2"></i>–û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
            <div id="docker-containers" class="space-y-3 scrollable-content-lg">
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-spinner fa-spin text-2xl mb-3"></i>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...</p>
                </div>
            </div>
        </div>

        <!-- –õ–æ–≥–∏ -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-file-alt text-green-500 mr-3"></i>
                    –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
                </h2>
                <div class="space-x-2">
                    <button onclick="loadSystemLogs()"
                            class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition-colors text-sm">
                        –°–∏—Å—Ç–µ–º–∞
                    </button>
                    <button onclick="loadDockerLogs()"
                            class="bg-gray-500 text-white px-3 py-1 rounded hover:bg-gray-600 transition-colors text-sm">
                        Docker
                    </button>
                </div>
            </div>
            <div id="recent-logs" class="space-y-2 scrollable-content-lg preformatted-text">
                <div class="text-center py-8 text-gray-500">
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ª–æ–≥–æ–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
function connectServer() {
    htmx.ajax('POST', '/api/connect/simple/', { target: '#connection-status' });
}

function disconnectServer() {
    htmx.ajax('POST', '/api/disconnect/', { target: '#connection-status' });
}

function checkAIStatus() {
    htmx.ajax('GET', '/api/ai/status/', { target: '#ai-status' });
}

function runQuickDiagnostic() {
    htmx.ajax('GET', '/api/diagnostic/quick/', { target: '#quick-diagnostic-result' });
}

function loadSystemResources() {
    htmx.ajax('GET', '/api/diagnostic/resources/', { target: '#system-resources' });
}

function loadDockerContainers() {
    htmx.ajax('GET', '/api/docker/containers/', { target: '#docker-containers' });
}

function loadSystemLogs() {
    htmx.ajax('GET', '/api/logs/system/?lines=5', { target: '#recent-logs' });
}

function loadDockerLogs() {
    htmx.ajax('GET', '/api/logs/docker/?lines=5', { target: '#recent-logs' });
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
document.addEventListener('DOMContentLoaded', function() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
    htmx.ajax('GET', '/api/status/', { target: '#connection-status' });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å –ò–ò
    htmx.ajax('GET', '/api/ai/status/', { target: '#ai-status' });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    loadDockerContainers();

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
    loadSystemLogs();
});

// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.target.id === 'connection-status') {
        const indicator = document.getElementById('status-indicator');
        const statusText = evt.target.textContent.toLowerCase();

        if (statusText.includes('–ø–æ–¥–∫–ª—é—á–µ–Ω') || statusText.includes('connected')) {
            indicator.className = 'w-3 h-3 bg-green-500 rounded-full animate-pulse';
        } else {
            indicator.className = 'w-3 h-3 bg-red-500 rounded-full';
        }
    }

    if (evt.target.id === 'ai-status') {
        const indicator = document.getElementById('ai-status-indicator');
        const statusText = evt.target.textContent.toLowerCase();

        if (statusText.includes('–ø–æ–¥–∫–ª—é—á–µ–Ω') || statusText.includes('connected')) {
            indicator.className = 'w-3 h-3 bg-green-500 rounded-full animate-pulse';
        } else {
            indicator.className = 'w-3 h-3 bg-red-500 rounded-full';
        }
    }
});
</script>
{% endblock %}